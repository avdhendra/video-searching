"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/login";
exports.ids = ["pages/api/login"];
exports.modules = {

/***/ "@magic-sdk/admin":
/*!***********************************!*\
  !*** external "@magic-sdk/admin" ***!
  \***********************************/
/***/ ((module) => {

module.exports = require("@magic-sdk/admin");

/***/ }),

/***/ "cookie":
/*!*************************!*\
  !*** external "cookie" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("cookie");

/***/ }),

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "(api)/./lib/cookies.js":
/*!************************!*\
  !*** ./lib/cookies.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"removeTokenCookie\": () => (/* binding */ removeTokenCookie),\n/* harmony export */   \"setTokenCookie\": () => (/* binding */ setTokenCookie)\n/* harmony export */ });\n/* harmony import */ var cookie__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! cookie */ \"cookie\");\n/* harmony import */ var cookie__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(cookie__WEBPACK_IMPORTED_MODULE_0__);\n\nconst MAX_AGE = 7 * 24 * 60 * 60;\nconst setTokenCookie = (token, res)=>{\n    const setCookie = cookie__WEBPACK_IMPORTED_MODULE_0___default().serialize(\"token\", token, {\n        maxAge: MAX_AGE,\n        expires: new Date(Date.now() + MAX_AGE * 1000),\n        secure: \"development\" === \"production\",\n        path: \"/\"\n    });\n    res.setHeader(\"Set-Cookie\", setCookie);\n};\nconst removeTokenCookie = (res)=>{\n    const val = cookie__WEBPACK_IMPORTED_MODULE_0___default().serialize(\"token\", \"\", {\n        maxAge: -1,\n        path: \"/\"\n    });\n    res.setHeader(\"Set-Cookie\", val);\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvY29va2llcy5qcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQTRCO0FBRTVCLE1BQU1DLFVBQVUsSUFBSSxLQUFLLEtBQUs7QUFFdkIsTUFBTUMsaUJBQWlCLENBQUNDLE9BQU9DLE1BQVE7SUFDNUMsTUFBTUMsWUFBWUwsdURBQWdCLENBQUMsU0FBU0csT0FBTztRQUNqREksUUFBUU47UUFDUk8sU0FBUyxJQUFJQyxLQUFLQSxLQUFLQyxHQUFHLEtBQUtULFVBQVU7UUFDekNVLFFBQVFDLGtCQUF5QjtRQUNqQ0MsTUFBTTtJQUNSO0lBQ0FULElBQUlVLFNBQVMsQ0FBQyxjQUFjVDtBQUM5QixFQUFFO0FBRUssTUFBTVUsb0JBQW9CLENBQUNYLE1BQVE7SUFDeEMsTUFBTVksTUFBTWhCLHVEQUFnQixDQUFDLFNBQVMsSUFBSTtRQUN4Q08sUUFBUSxDQUFDO1FBQ1RNLE1BQU07SUFDUjtJQUVBVCxJQUFJVSxTQUFTLENBQUMsY0FBY0U7QUFDOUIsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL25ldGZsaXgtY2xvbmUvLi9saWIvY29va2llcy5qcz80N2VkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjb29raWUgZnJvbSBcImNvb2tpZVwiO1xyXG5cclxuY29uc3QgTUFYX0FHRSA9IDcgKiAyNCAqIDYwICogNjA7XHJcblxyXG5leHBvcnQgY29uc3Qgc2V0VG9rZW5Db29raWUgPSAodG9rZW4sIHJlcykgPT4ge1xyXG4gIGNvbnN0IHNldENvb2tpZSA9IGNvb2tpZS5zZXJpYWxpemUoXCJ0b2tlblwiLCB0b2tlbiwge1xyXG4gICAgbWF4QWdlOiBNQVhfQUdFLFxyXG4gICAgZXhwaXJlczogbmV3IERhdGUoRGF0ZS5ub3coKSArIE1BWF9BR0UgKiAxMDAwKSxcclxuICAgIHNlY3VyZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiLFxyXG4gICAgcGF0aDogXCIvXCIsXHJcbiAgfSk7XHJcbiAgcmVzLnNldEhlYWRlcihcIlNldC1Db29raWVcIiwgc2V0Q29va2llKTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCByZW1vdmVUb2tlbkNvb2tpZSA9IChyZXMpID0+IHtcclxuICBjb25zdCB2YWwgPSBjb29raWUuc2VyaWFsaXplKFwidG9rZW5cIiwgXCJcIiwge1xyXG4gICAgbWF4QWdlOiAtMSxcclxuICAgIHBhdGg6IFwiL1wiLFxyXG4gIH0pO1xyXG5cclxuICByZXMuc2V0SGVhZGVyKFwiU2V0LUNvb2tpZVwiLCB2YWwpO1xyXG59OyJdLCJuYW1lcyI6WyJjb29raWUiLCJNQVhfQUdFIiwic2V0VG9rZW5Db29raWUiLCJ0b2tlbiIsInJlcyIsInNldENvb2tpZSIsInNlcmlhbGl6ZSIsIm1heEFnZSIsImV4cGlyZXMiLCJEYXRlIiwibm93Iiwic2VjdXJlIiwicHJvY2VzcyIsInBhdGgiLCJzZXRIZWFkZXIiLCJyZW1vdmVUb2tlbkNvb2tpZSIsInZhbCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/cookies.js\n");

/***/ }),

/***/ "(api)/./lib/db/hasura.js":
/*!**************************!*\
  !*** ./lib/db/hasura.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"createNewUser\": () => (/* binding */ createNewUser),\n/* harmony export */   \"findVideoIdByUser\": () => (/* binding */ findVideoIdByUser),\n/* harmony export */   \"getMyListVideos\": () => (/* binding */ getMyListVideos),\n/* harmony export */   \"getWatchedVideos\": () => (/* binding */ getWatchedVideos),\n/* harmony export */   \"insertStats\": () => (/* binding */ insertStats),\n/* harmony export */   \"isNewUser\": () => (/* binding */ isNewUser),\n/* harmony export */   \"updateStats\": () => (/* binding */ updateStats)\n/* harmony export */ });\nasync function insertStats(token, { favorited , userId , watched , videoId  }) {\n    const operationsDoc = `mutation insertStats($favorited: Int!, $userId: String!, $watched: Boolean!, $videoId: String!){\r\n        insert_stats_one(object: {\r\n            favorited: $favorited,\r\n            userId: $userId,\r\n            watched: $watched,\r\n            videoId: $videoId\r\n        }){\r\n            favorited\r\n            userId\r\n        }\r\n    }`;\n    return await queryHasuraGQL(operationsDoc, \"insertStats\", {\n        favorited,\n        userId,\n        watched,\n        videoId\n    }, token);\n}\nasync function updateStats(token, { favorited , userId , watched , videoId  }) {\n    const operationDoc = `mutation updateStats($favorited:Int!,$userId:String!,$watched:Boolean!,$videoId:String!){\r\n        update_stats(\r\n            _set:{watched:$watched,favorited:$favorited},\r\n            where:{\r\n                userId:{_eq:$userId},\r\n                videoId:{_eq:$videoId}\r\n            }){\r\n                returning{\r\n                    favorited,userId,videoId,watched\r\n                }\r\n            }\r\n    }`;\n    return await queryHasuraGQL(operationDoc, \"updateStats\", {\n        favorited,\n        userId,\n        watched,\n        videoId\n    }, token);\n}\nasync function findVideoIdByUser(token, userId, videoId) {\n    var _response_data;\n    const operationDoc = `query findVideoIdByUserId($userId:String!,$videoId:String!){\r\n        stats(where:{userId:{_eq:$userId},videoId:{_eq:$videoId}}){\r\n            id\r\n            userId\r\n            videoId\r\n            favorited\r\n            watched\r\n        }\r\n    }`;\n    const response = await queryHasuraGQL(operationDoc, \"findVideoByIdUserId\", {\n        videoId,\n        userId\n    }, token);\n    return response === null || response === void 0 ? void 0 : (_response_data = response.data) === null || _response_data === void 0 ? void 0 : _response_data.stats;\n}\nasync function createNewUser(token, metadata) {\n    const operationDoc = `mutation createNewUser($isuser:String!,$email: String!, $publicAddress: String!){\r\n         insert_users(objects: {email: $email, issuer: $issuer, publicAddress: $publicAddress}) {\r\n      returning {\r\n        email\r\n        id\r\n        issuer\r\n      }\r\n    }\r\n    }`;\n    const { issuer , email , publicAddress  } = metadata;\n    const response = await queryHasuraGQL(operationDoc, \"createNewUser\", {\n        issuer,\n        email,\n        publicAddress\n    }, token);\n    return response;\n}\nasync function isNewUser(token, issuer) {\n    var _response_data, _response_data_users;\n    const operationsDoc = `\r\n  query isNewUser($issuer: String!) {\r\n    users(where: {issuer: {_eq: $issuer}}) {\r\n      id\r\n      email\r\n      issuer\r\n    }\r\n  }\r\n`;\n    const response = await queryHasuraGQL(operationsDoc, \"isNewUser\", {\n        issuer\n    }, token);\n    return (response === null || response === void 0 ? void 0 : (_response_data = response.data) === null || _response_data === void 0 ? void 0 : (_response_data_users = _response_data.users) === null || _response_data_users === void 0 ? void 0 : _response_data_users.length) === 0;\n}\nasync function queryHasuraGQL(operationsDoc, operationName, variables, token) {\n    const result = await fetch(\"ooW82lNhzC7oRL2cKHK3TaZpC7Xb1PnTlV5jGeqkb338XKAsNgWrfhkBtGEFGvnn\", {\n        method: \"POST\",\n        headers: {\n            Authorization: `Bearer ${token}`,\n            \"Content-type\": \"application/json\"\n        },\n        body: JSON.stringify({\n            query: operationsDoc,\n            variables: variables,\n            operationName: operationName\n        })\n    });\n    return await result.json();\n}\nasync function getWatchedVideos(userId, token) {\n    var _response_data;\n    const operationsDoc = `\r\n  query watchedVideos($userId: String!) {\r\n    stats(where: {\r\n      watched: {_eq: true}, \r\n      userId: {_eq: $userId},\r\n    }) {\r\n      videoId\r\n    }\r\n  }\r\n`;\n    const response = await queryHasuraGQL(operationsDoc, \"watchedVideos\", {\n        userId\n    }, token);\n    return response === null || response === void 0 ? void 0 : (_response_data = response.data) === null || _response_data === void 0 ? void 0 : _response_data.stats;\n}\nasync function getMyListVideos(userId, token) {\n    var _response_data;\n    const operationsDoc = `\r\n  query favouritedVideos($userId: String!) {\r\n    stats(where: {\r\n      userId: {_eq: $userId}, \r\n      favourited: {_eq: 1}\r\n    }) {\r\n      videoId\r\n    }\r\n  }\r\n`;\n    const response = await queryHasuraGQL(operationsDoc, \"favouritedVideos\", {\n        userId\n    }, token);\n    return response === null || response === void 0 ? void 0 : (_response_data = response.data) === null || _response_data === void 0 ? void 0 : _response_data.stats;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvZGIvaGFzdXJhLmpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBTyxlQUFlQSxZQUNsQkMsS0FBSyxFQUFDLEVBQUNDLFVBQVMsRUFBQ0MsT0FBTSxFQUFDQyxRQUFPLEVBQUNDLFFBQU8sRUFBQyxFQUMxQztJQUNFLE1BQU1DLGdCQUFnQixDQUFDO0lBV3ZCLE9BQU8sTUFBTUMsZUFDVEQ7UUFFRUo7UUFBV0M7UUFBUUM7UUFBU0M7SUFBUSxHQUN0Q0o7QUFFUixDQUFDO0FBRUQsT0FBTztJQUdILE1BQU1RO0lBYVY7UUFBd0RQO1FBQVVDO1FBQU9DO1FBQVFDO0lBQU8sR0FBRUo7QUFFMUYsQ0FBQztBQUNEO0NBa0JXVTtJQWpCUCxNQUFNRixlQUFlLENBQUM7SUFTdEIsTUFBTUUsV0FBVztRQUlUTjtRQUNBRjtJQUNKLEdBQUdGO0lBRVAsT0FBT1UscUJBQUFBO0FBQ1gsQ0FBQztBQUNELE9BQU8sZUFBZUc7SUFDbEIsTUFBTUwsZUFBYyxDQUFDO0lBU3JCLE1BQU0sRUFBRU87SUFDVixNQUFNTDs7UUFLRk07UUFDQUM7SUFDRixHQUNBakI7SUFHRixPQUFPVTtBQUNULENBQUM7QUFFRCxPQUFPOztBQUNMLEdBQU1MLGdCQUFnQixDQUFDO0lBVXZCLE1BQU1LLFdBQVc7UUFJYks7SUFDRixHQUNBZjtJQUdGLE9BQU9VLENBQUFBO0FBQ1QsQ0FBQztBQUVELGVBQWVKO0lBQ2IsTUFBTWlCLFNBQVM7UUFDYkssUUFBUTtRQUNSQzs7WUFFRSxnQkFBZ0I7UUFDbEI7UUFDQUUsTUFBTUM7WUFDSkU7WUFDQVosV0FBV0E7O0NBRWI7SUFDRjtJQUVBLE9BQU8sTUFBTUMsT0FBT1ksSUFBSTtBQUMxQjtBQUVBLE9BQU87UUFxQkV6QjtJQXBCUCxNQUFNTDtJQVdOOztJQUtFLEdBQ0FMO0lBR0YsT0FBT1UscUJBQUFBLHNCQUFBQTtBQUNULENBQUM7QUFFRCxPQUFPO1FBcUJFQTtJQXBCUCxNQUFNTDtJQVdOLE1BQU1LO1FBSUZSOztBQUtKLElBQU9RLHFCQUFBQTtBQUNULENBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZXRmbGl4LWNsb25lLy4vbGliL2RiL2hhc3VyYS5qcz9hZjJjIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBhc3luYyBmdW5jdGlvbiBpbnNlcnRTdGF0cyhcclxuICAgIHRva2VuLHtmYXZvcml0ZWQsdXNlcklkLHdhdGNoZWQsdmlkZW9JZH1cclxuKSB7XHJcbiAgICBjb25zdCBvcGVyYXRpb25zRG9jID0gYG11dGF0aW9uIGluc2VydFN0YXRzKCRmYXZvcml0ZWQ6IEludCEsICR1c2VySWQ6IFN0cmluZyEsICR3YXRjaGVkOiBCb29sZWFuISwgJHZpZGVvSWQ6IFN0cmluZyEpe1xyXG4gICAgICAgIGluc2VydF9zdGF0c19vbmUob2JqZWN0OiB7XHJcbiAgICAgICAgICAgIGZhdm9yaXRlZDogJGZhdm9yaXRlZCxcclxuICAgICAgICAgICAgdXNlcklkOiAkdXNlcklkLFxyXG4gICAgICAgICAgICB3YXRjaGVkOiAkd2F0Y2hlZCxcclxuICAgICAgICAgICAgdmlkZW9JZDogJHZpZGVvSWRcclxuICAgICAgICB9KXtcclxuICAgICAgICAgICAgZmF2b3JpdGVkXHJcbiAgICAgICAgICAgIHVzZXJJZFxyXG4gICAgICAgIH1cclxuICAgIH1gXHJcbiAgICByZXR1cm4gYXdhaXQgcXVlcnlIYXN1cmFHUUwoXHJcbiAgICAgICAgb3BlcmF0aW9uc0RvYyxcclxuICAgICAgICBcImluc2VydFN0YXRzXCIsXHJcbiAgICAgICAgeyBmYXZvcml0ZWQsIHVzZXJJZCwgd2F0Y2hlZCwgdmlkZW9JZCB9LFxyXG4gICAgICAgIHRva2VuXHJcbiAgICApXHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVTdGF0cyhcclxuICAgIHRva2VuLHtmYXZvcml0ZWQsdXNlcklkLCB3YXRjaGVkLCB2aWRlb0lkfVxyXG4pIHtcclxuICAgIGNvbnN0IG9wZXJhdGlvbkRvYyA9IGBtdXRhdGlvbiB1cGRhdGVTdGF0cygkZmF2b3JpdGVkOkludCEsJHVzZXJJZDpTdHJpbmchLCR3YXRjaGVkOkJvb2xlYW4hLCR2aWRlb0lkOlN0cmluZyEpe1xyXG4gICAgICAgIHVwZGF0ZV9zdGF0cyhcclxuICAgICAgICAgICAgX3NldDp7d2F0Y2hlZDokd2F0Y2hlZCxmYXZvcml0ZWQ6JGZhdm9yaXRlZH0sXHJcbiAgICAgICAgICAgIHdoZXJlOntcclxuICAgICAgICAgICAgICAgIHVzZXJJZDp7X2VxOiR1c2VySWR9LFxyXG4gICAgICAgICAgICAgICAgdmlkZW9JZDp7X2VxOiR2aWRlb0lkfVxyXG4gICAgICAgICAgICB9KXtcclxuICAgICAgICAgICAgICAgIHJldHVybmluZ3tcclxuICAgICAgICAgICAgICAgICAgICBmYXZvcml0ZWQsdXNlcklkLHZpZGVvSWQsd2F0Y2hlZFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICB9YDtcclxuXHJcbnJldHVybiBhd2FpdCBxdWVyeUhhc3VyYUdRTChvcGVyYXRpb25Eb2MsXCJ1cGRhdGVTdGF0c1wiLHtmYXZvcml0ZWQsdXNlcklkLHdhdGNoZWQsdmlkZW9JZH0sdG9rZW4pO1xyXG5cclxufVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmluZFZpZGVvSWRCeVVzZXIodG9rZW4sIHVzZXJJZCwgdmlkZW9JZCkge1xyXG4gICAgY29uc3Qgb3BlcmF0aW9uRG9jID0gYHF1ZXJ5IGZpbmRWaWRlb0lkQnlVc2VySWQoJHVzZXJJZDpTdHJpbmchLCR2aWRlb0lkOlN0cmluZyEpe1xyXG4gICAgICAgIHN0YXRzKHdoZXJlOnt1c2VySWQ6e19lcTokdXNlcklkfSx2aWRlb0lkOntfZXE6JHZpZGVvSWR9fSl7XHJcbiAgICAgICAgICAgIGlkXHJcbiAgICAgICAgICAgIHVzZXJJZFxyXG4gICAgICAgICAgICB2aWRlb0lkXHJcbiAgICAgICAgICAgIGZhdm9yaXRlZFxyXG4gICAgICAgICAgICB3YXRjaGVkXHJcbiAgICAgICAgfVxyXG4gICAgfWA7XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHF1ZXJ5SGFzdXJhR1FMKFxyXG4gICAgICAgIG9wZXJhdGlvbkRvYyxcclxuICAgICAgICBcImZpbmRWaWRlb0J5SWRVc2VySWRcIixcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZpZGVvSWQsXHJcbiAgICAgICAgICAgIHVzZXJJZFxyXG4gICAgICAgIH0sIHRva2VuXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHJlc3BvbnNlPy5kYXRhPy5zdGF0cztcclxufVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlTmV3VXNlcih0b2tlbiwgbWV0YWRhdGEpIHtcclxuICAgIGNvbnN0IG9wZXJhdGlvbkRvYyA9YG11dGF0aW9uIGNyZWF0ZU5ld1VzZXIoJGlzdXNlcjpTdHJpbmchLCRlbWFpbDogU3RyaW5nISwgJHB1YmxpY0FkZHJlc3M6IFN0cmluZyEpe1xyXG4gICAgICAgICBpbnNlcnRfdXNlcnMob2JqZWN0czoge2VtYWlsOiAkZW1haWwsIGlzc3VlcjogJGlzc3VlciwgcHVibGljQWRkcmVzczogJHB1YmxpY0FkZHJlc3N9KSB7XHJcbiAgICAgIHJldHVybmluZyB7XHJcbiAgICAgICAgZW1haWxcclxuICAgICAgICBpZFxyXG4gICAgICAgIGlzc3VlclxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB9YFxyXG4gICAgY29uc3QgeyBpc3N1ZXIsIGVtYWlsLCBwdWJsaWNBZGRyZXNzIH0gPSBtZXRhZGF0YTtcclxuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHF1ZXJ5SGFzdXJhR1FMKFxyXG4gICAgb3BlcmF0aW9uRG9jLFxyXG4gICAgXCJjcmVhdGVOZXdVc2VyXCIsXHJcbiAgICB7XHJcbiAgICAgIGlzc3VlcixcclxuICAgICAgZW1haWwsXHJcbiAgICAgIHB1YmxpY0FkZHJlc3MsXHJcbiAgICB9LFxyXG4gICAgdG9rZW5cclxuICApO1xyXG5cclxuICByZXR1cm4gcmVzcG9uc2U7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpc05ld1VzZXIodG9rZW4sIGlzc3Vlcikge1xyXG4gIGNvbnN0IG9wZXJhdGlvbnNEb2MgPSBgXHJcbiAgcXVlcnkgaXNOZXdVc2VyKCRpc3N1ZXI6IFN0cmluZyEpIHtcclxuICAgIHVzZXJzKHdoZXJlOiB7aXNzdWVyOiB7X2VxOiAkaXNzdWVyfX0pIHtcclxuICAgICAgaWRcclxuICAgICAgZW1haWxcclxuICAgICAgaXNzdWVyXHJcbiAgICB9XHJcbiAgfVxyXG5gO1xyXG5cclxuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHF1ZXJ5SGFzdXJhR1FMKFxyXG4gICAgb3BlcmF0aW9uc0RvYyxcclxuICAgIFwiaXNOZXdVc2VyXCIsXHJcbiAgICB7XHJcbiAgICAgIGlzc3VlcixcclxuICAgIH0sXHJcbiAgICB0b2tlblxyXG4gICk7XHJcblxyXG4gIHJldHVybiByZXNwb25zZT8uZGF0YT8udXNlcnM/Lmxlbmd0aCA9PT0gMDtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gcXVlcnlIYXN1cmFHUUwob3BlcmF0aW9uc0RvYywgb3BlcmF0aW9uTmFtZSwgdmFyaWFibGVzLCB0b2tlbikge1xyXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGZldGNoKHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0hBU1VSQV9BRE1JTl9VUkwsIHtcclxuICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gLFxyXG4gICAgICBcIkNvbnRlbnQtdHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgIH0sXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIHF1ZXJ5OiBvcGVyYXRpb25zRG9jLFxyXG4gICAgICB2YXJpYWJsZXM6IHZhcmlhYmxlcyxcclxuICAgICAgb3BlcmF0aW9uTmFtZTogb3BlcmF0aW9uTmFtZSxcclxuICAgIH0pLFxyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gYXdhaXQgcmVzdWx0Lmpzb24oKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFdhdGNoZWRWaWRlb3ModXNlcklkLCB0b2tlbikge1xyXG4gIGNvbnN0IG9wZXJhdGlvbnNEb2MgPSBgXHJcbiAgcXVlcnkgd2F0Y2hlZFZpZGVvcygkdXNlcklkOiBTdHJpbmchKSB7XHJcbiAgICBzdGF0cyh3aGVyZToge1xyXG4gICAgICB3YXRjaGVkOiB7X2VxOiB0cnVlfSwgXHJcbiAgICAgIHVzZXJJZDoge19lcTogJHVzZXJJZH0sXHJcbiAgICB9KSB7XHJcbiAgICAgIHZpZGVvSWRcclxuICAgIH1cclxuICB9XHJcbmA7XHJcblxyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcXVlcnlIYXN1cmFHUUwoXHJcbiAgICBvcGVyYXRpb25zRG9jLFxyXG4gICAgXCJ3YXRjaGVkVmlkZW9zXCIsXHJcbiAgICB7XHJcbiAgICAgIHVzZXJJZCxcclxuICAgIH0sXHJcbiAgICB0b2tlblxyXG4gICk7XHJcblxyXG4gIHJldHVybiByZXNwb25zZT8uZGF0YT8uc3RhdHM7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRNeUxpc3RWaWRlb3ModXNlcklkLCB0b2tlbikge1xyXG4gIGNvbnN0IG9wZXJhdGlvbnNEb2MgPSBgXHJcbiAgcXVlcnkgZmF2b3VyaXRlZFZpZGVvcygkdXNlcklkOiBTdHJpbmchKSB7XHJcbiAgICBzdGF0cyh3aGVyZToge1xyXG4gICAgICB1c2VySWQ6IHtfZXE6ICR1c2VySWR9LCBcclxuICAgICAgZmF2b3VyaXRlZDoge19lcTogMX1cclxuICAgIH0pIHtcclxuICAgICAgdmlkZW9JZFxyXG4gICAgfVxyXG4gIH1cclxuYDtcclxuXHJcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBxdWVyeUhhc3VyYUdRTChcclxuICAgIG9wZXJhdGlvbnNEb2MsXHJcbiAgICBcImZhdm91cml0ZWRWaWRlb3NcIixcclxuICAgIHtcclxuICAgICAgdXNlcklkLFxyXG4gICAgfSxcclxuICAgIHRva2VuXHJcbiAgKTtcclxuXHJcbiAgcmV0dXJuIHJlc3BvbnNlPy5kYXRhPy5zdGF0cztcclxufSJdLCJuYW1lcyI6WyJpbnNlcnRTdGF0cyIsInRva2VuIiwiZmF2b3JpdGVkIiwidXNlcklkIiwid2F0Y2hlZCIsInZpZGVvSWQiLCJvcGVyYXRpb25zRG9jIiwicXVlcnlIYXN1cmFHUUwiLCJ1cGRhdGVTdGF0cyIsIm9wZXJhdGlvbkRvYyIsImZpbmRWaWRlb0lkQnlVc2VyIiwicmVzcG9uc2UiLCJkYXRhIiwic3RhdHMiLCJjcmVhdGVOZXdVc2VyIiwibWV0YWRhdGEiLCJpc3N1ZXIiLCJlbWFpbCIsInB1YmxpY0FkZHJlc3MiLCJpc05ld1VzZXIiLCJ1c2VycyIsImxlbmd0aCIsIm9wZXJhdGlvbk5hbWUiLCJ2YXJpYWJsZXMiLCJyZXN1bHQiLCJmZXRjaCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19IQVNVUkFfQURNSU5fVVJMIiwibWV0aG9kIiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInF1ZXJ5IiwianNvbiIsImdldFdhdGNoZWRWaWRlb3MiLCJnZXRNeUxpc3RWaWRlb3MiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./lib/db/hasura.js\n");

/***/ }),

/***/ "(api)/./lib/magic.js":
/*!**********************!*\
  !*** ./lib/magic.js ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"magicAdmin\": () => (/* binding */ magicAdmin)\n/* harmony export */ });\n/* harmony import */ var _magic_sdk_admin__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @magic-sdk/admin */ \"@magic-sdk/admin\");\n/* harmony import */ var _magic_sdk_admin__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_magic_sdk_admin__WEBPACK_IMPORTED_MODULE_0__);\n\nconst magicAdmin = new _magic_sdk_admin__WEBPACK_IMPORTED_MODULE_0__.Magic(process.env.MAGIC_SERVER_KEY);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvbWFnaWMuanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXlDO0FBRWxDLE1BQU1DLGFBQWEsSUFBSUQsbURBQUtBLENBQUNFLFFBQVFDLEdBQUcsQ0FBQ0MsZ0JBQWdCLEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZXRmbGl4LWNsb25lLy4vbGliL21hZ2ljLmpzP2EyNzUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWFnaWMgfSBmcm9tIFwiQG1hZ2ljLXNkay9hZG1pblwiO1xyXG5cclxuZXhwb3J0IGNvbnN0IG1hZ2ljQWRtaW4gPSBuZXcgTWFnaWMocHJvY2Vzcy5lbnYuTUFHSUNfU0VSVkVSX0tFWSk7ICJdLCJuYW1lcyI6WyJNYWdpYyIsIm1hZ2ljQWRtaW4iLCJwcm9jZXNzIiwiZW52IiwiTUFHSUNfU0VSVkVSX0tFWSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/magic.js\n");

/***/ }),

/***/ "(api)/./pages/api/login.js":
/*!****************************!*\
  !*** ./pages/api/login.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ login)\n/* harmony export */ });\n/* harmony import */ var _lib_magic__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/magic */ \"(api)/./lib/magic.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_db_hasura__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../lib/db/hasura */ \"(api)/./lib/db/hasura.js\");\n/* harmony import */ var _lib_cookies__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../lib/cookies */ \"(api)/./lib/cookies.js\");\n\n\n\n\nasync function login(req, res) {\n    if (req.method === \"POST\") {\n        try {\n            const auth = req.headers.authorization;\n            const didToken = auth ? auth.substr(7) : \"\";\n            const metadata = await _lib_magic__WEBPACK_IMPORTED_MODULE_0__.magicAdmin.users.getMetadataByToken(didToken);\n            const token = jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().sign({\n                ...metadata,\n                iat: Math.floor(Date.now() / 1000),\n                exp: Math.floor(Date.now() / 1000 + 7 * 24 * 60 * 60),\n                \"https://hasura.io/jwt/claims\": {\n                    \"x-hasura-allowed-roles\": [\n                        \"user\",\n                        \"admin\"\n                    ],\n                    \"x-hasura-default-role\": \"user\",\n                    \"x-hasura-user-id\": `${metadata.issuer}`\n                }\n            }, process.env.JWT_SECRET);\n            const isNewUserQuery = await (0,_lib_db_hasura__WEBPACK_IMPORTED_MODULE_2__.isNewUser)(token, metadata.issuer);\n            isNewUserQuery && await (0,_lib_db_hasura__WEBPACK_IMPORTED_MODULE_2__.createNewUser)(token, metadata);\n            (0,_lib_cookies__WEBPACK_IMPORTED_MODULE_3__.setTokenCookie)(token, res);\n            res.send({\n                done: true\n            });\n        } catch (error) {\n            console.error(\"Something went wrong logging in\", error);\n            res.status(500).send({\n                done: false\n            });\n        }\n    } else {\n        res.send({\n            done: false\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvbG9naW4uanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQTZDO0FBQ2Q7QUFDZ0M7QUFDWjtBQUVwQyxlQUFlSyxNQUFNQyxHQUFHLEVBQUVDLEdBQUcsRUFBRTtJQUM1QyxJQUFJRCxJQUFJRSxNQUFNLEtBQUssUUFBUTtRQUN6QixJQUFJO1lBQ0YsTUFBTUMsT0FBT0gsSUFBSUksT0FBTyxDQUFDQyxhQUFhO1lBQ3RDLE1BQU1DLFdBQVdILE9BQU9BLEtBQUtJLE1BQU0sQ0FBQyxLQUFLLEVBQUU7WUFFM0MsTUFBTUMsV0FBVyxNQUFNZCwyRUFBbUMsQ0FBQ1k7WUFFM0QsTUFBTUssUUFBUWhCLHdEQUFRLENBQ3BCO2dCQUNFLEdBQUdhLFFBQVE7Z0JBQ1hLLEtBQUtDLEtBQUtDLEtBQUssQ0FBQ0MsS0FBS0MsR0FBRyxLQUFLO2dCQUM3QkMsS0FBS0osS0FBS0MsS0FBSyxDQUFDQyxLQUFLQyxHQUFHLEtBQUssT0FBTyxJQUFJLEtBQUssS0FBSztnQkFDbEQsZ0NBQWdDO29CQUM5QiwwQkFBMEI7d0JBQUM7d0JBQVE7cUJBQVE7b0JBQzNDLHlCQUF5QjtvQkFDekIsb0JBQW9CLENBQUMsRUFBRVQsU0FBU1csTUFBTSxDQUFDLENBQUM7Z0JBQzFDO1lBQ0YsR0FDQUMsUUFBUUMsR0FBRyxDQUFDQyxVQUFVO1lBSXhCLE1BQU1DLGlCQUFpQixNQUFNMUIseURBQVNBLENBQUNjLE9BQU9ILFNBQVNXLE1BQU07WUFDN0RJLGtCQUFtQixNQUFNM0IsNkRBQWFBLENBQUNlLE9BQU9IO1lBQzlDViw0REFBY0EsQ0FBQ2EsT0FBT1Y7WUFDdEJBLElBQUl1QixJQUFJLENBQUM7Z0JBQUVDLE1BQU0sSUFBSTtZQUFDO1FBQ3hCLEVBQUUsT0FBT0MsT0FBTztZQUNkQyxRQUFRRCxLQUFLLENBQUMsbUNBQW1DQTtZQUNqRHpCLElBQUkyQixNQUFNLENBQUMsS0FBS0osSUFBSSxDQUFDO2dCQUFFQyxNQUFNLEtBQUs7WUFBQztRQUNyQztJQUNGLE9BQU87UUFDTHhCLElBQUl1QixJQUFJLENBQUM7WUFBRUMsTUFBTSxLQUFLO1FBQUM7SUFDekIsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZXRmbGl4LWNsb25lLy4vcGFnZXMvYXBpL2xvZ2luLmpzP2FlODgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbWFnaWNBZG1pbiB9IGZyb20gXCIuLi8uLi9saWIvbWFnaWNcIjtcclxuaW1wb3J0IGp3dCBmcm9tIFwianNvbndlYnRva2VuXCI7XHJcbmltcG9ydCB7IGNyZWF0ZU5ld1VzZXIsIGlzTmV3VXNlciB9IGZyb20gXCIuLi8uLi9saWIvZGIvaGFzdXJhXCI7XHJcbmltcG9ydCB7IHNldFRva2VuQ29va2llIH0gZnJvbSBcIi4uLy4uL2xpYi9jb29raWVzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBsb2dpbihyZXEsIHJlcykge1xyXG4gIGlmIChyZXEubWV0aG9kID09PSBcIlBPU1RcIikge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgYXV0aCA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb247XHJcbiAgICAgIGNvbnN0IGRpZFRva2VuID0gYXV0aCA/IGF1dGguc3Vic3RyKDcpIDogXCJcIjtcclxuXHJcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gYXdhaXQgbWFnaWNBZG1pbi51c2Vycy5nZXRNZXRhZGF0YUJ5VG9rZW4oZGlkVG9rZW4pO1xyXG5cclxuICAgICAgY29uc3QgdG9rZW4gPSBqd3Quc2lnbihcclxuICAgICAgICB7XHJcbiAgICAgICAgICAuLi5tZXRhZGF0YSxcclxuICAgICAgICAgIGlhdDogTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCksXHJcbiAgICAgICAgICBleHA6IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDAgKyA3ICogMjQgKiA2MCAqIDYwKSxcclxuICAgICAgICAgIFwiaHR0cHM6Ly9oYXN1cmEuaW8vand0L2NsYWltc1wiOiB7XHJcbiAgICAgICAgICAgIFwieC1oYXN1cmEtYWxsb3dlZC1yb2xlc1wiOiBbXCJ1c2VyXCIsIFwiYWRtaW5cIl0sXHJcbiAgICAgICAgICAgIFwieC1oYXN1cmEtZGVmYXVsdC1yb2xlXCI6IFwidXNlclwiLFxyXG4gICAgICAgICAgICBcIngtaGFzdXJhLXVzZXItaWRcIjogYCR7bWV0YWRhdGEuaXNzdWVyfWAsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVFxyXG4gICAgICAgICk7XHJcbiAgICAgICBcclxuXHJcbiAgICAgIGNvbnN0IGlzTmV3VXNlclF1ZXJ5ID0gYXdhaXQgaXNOZXdVc2VyKHRva2VuLCBtZXRhZGF0YS5pc3N1ZXIpO1xyXG4gICAgICBpc05ld1VzZXJRdWVyeSAmJiAoYXdhaXQgY3JlYXRlTmV3VXNlcih0b2tlbiwgbWV0YWRhdGEpKTtcclxuICAgICAgc2V0VG9rZW5Db29raWUodG9rZW4sIHJlcyk7XHJcbiAgICAgIHJlcy5zZW5kKHsgZG9uZTogdHJ1ZSB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJTb21ldGhpbmcgd2VudCB3cm9uZyBsb2dnaW5nIGluXCIsIGVycm9yKTtcclxuICAgICAgcmVzLnN0YXR1cyg1MDApLnNlbmQoeyBkb25lOiBmYWxzZSB9KTtcclxuICAgIH1cclxuICB9IGVsc2Uge1xyXG4gICAgcmVzLnNlbmQoeyBkb25lOiBmYWxzZSB9KTtcclxuICB9XHJcbn1cclxuXHJcbiJdLCJuYW1lcyI6WyJtYWdpY0FkbWluIiwiand0IiwiY3JlYXRlTmV3VXNlciIsImlzTmV3VXNlciIsInNldFRva2VuQ29va2llIiwibG9naW4iLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJhdXRoIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJkaWRUb2tlbiIsInN1YnN0ciIsIm1ldGFkYXRhIiwidXNlcnMiLCJnZXRNZXRhZGF0YUJ5VG9rZW4iLCJ0b2tlbiIsInNpZ24iLCJpYXQiLCJNYXRoIiwiZmxvb3IiLCJEYXRlIiwibm93IiwiZXhwIiwiaXNzdWVyIiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJpc05ld1VzZXJRdWVyeSIsInNlbmQiLCJkb25lIiwiZXJyb3IiLCJjb25zb2xlIiwic3RhdHVzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/login.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/login.js"));
module.exports = __webpack_exports__;

})();